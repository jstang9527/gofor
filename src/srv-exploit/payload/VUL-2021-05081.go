package payload

import (
	"github.com/go-redis/redis"
	"github.com/jstang9527/gofor/src/share/proxy"
)

type VUL_2021_05081 struct {
	target string // "127.0.0.1:6379"
}

func NewVUL_2021_05081(target string) *VUL_2021_05081 {
	return &VUL_2021_05081{target: target}
}

// Attack 无密码连接
func (r *VUL_2021_05081) Attack() (string, error) {
	rdb := redis.NewClient(&redis.Options{Addr: r.target, Password: "", DB: 0})
	if _, err := rdb.Ping().Result(); err != nil {
		return "", err
	}
	return "", nil
}

// CreateProxy ...
func (r *VUL_2021_05081) CreateProxy() (string, error) {
	return proxy.NewProxy(proxy.ProxyTypeTCP, r.target).Run()
}
